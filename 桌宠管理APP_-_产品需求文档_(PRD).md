📱 桌宠管理APP - 产品需求文档 (PRD) 文档版本： V1.0 创建日期： 2026-02-24 文档状态： 待评审 保密级别： 内部公开 📋 文档修订记录 | 版本 | 日期 | 作者 | 修订内容 | 审核人 | |:---:|:---:|:---:|:---:|:---:| | V1.0 | 2026-02-24 | 产品部 | 初始版本创建 | - | 目录 1.产品概述 2.用户角色与场景 3.功能需求规格 4.非功能需求 5.数据模型设计 6.API接口定义 7.UI/UX设计规范 8.技术约束与依赖 9.验收标准 10.开发里程碑 1. 产品概述 1.1 产品定位 一款基于AI的智能桌面宠物管理应用，通过悬浮窗形式在手机桌面展示可互动的虚拟宠物，具备对话聊天、任务执行、桌面整理、技能扩展等能力，为用户提供陪伴感和效率提升。 1.2 产品愿景 让每个用户都拥有一个懂你、帮你的AI桌面伙伴 1.3 核心价值主张 | 价值维度 | 描述 | |:---:|:---| | 情感陪伴 | 24小时在线的虚拟宠物，提供情绪价值和陪伴感 | | 效率提升 | 通过AI Agent自动执行日常任务，减少手动操作 | | 个性表达 | 丰富的皮肤系统和可定制的宠物性格 | | 能力扩展 | 开放的技能市场，持续扩展宠物能力边界 | 1.4 目标用户 | 用户类型 | 特征描述 | 占比预估 | |:---:|:---:|:---:| | Z世代用户 | 18-25岁，喜欢个性化表达，追求新鲜体验 | 45% | | 效率追求者 | 25-35岁，职场人士，希望提升手机使用效率 | 30% | | 科技爱好者 | 喜欢尝试新技术，对AI产品有较高接受度 | 15% | | 其他用户 | 其他年龄段和需求的用户 | 10% | 1.5 竞品分析 | 竞品名称 | 核心功能 | 优势 | 劣势 | 我们的差异化 | |:---:|:---:|:---:|:---:|:---:| | VPet | 桌面虚拟宠物 | 开源免费、动画丰富 | 无AI能力、功能单一 | AI对话+Agent任务执行 | | 人工桌面 | 动态桌面+小组件 | 视觉效果佳 | 无互动能力 | 深度互动+技能扩展 | | AI助手类 | 语音助手 | 功能强大 | 缺乏情感化设计 | 情感化宠物形象+可视化互动 | 2. 用户角色与场景 2.1 用户角色定义 ┌─────────────────────────────────────────────────────────────────────────┐ │ 用户角色体系 │ ├─────────────────────────────────────────────────────────────────────────┤ │ │ │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │ │ │ 普通用户 │ │ 高级用户 │ │ 技能开发者 │ │ │ │ (Free) │ │ (Premium) │ │ (Developer)│ │ │ ├─────────────┤ ├─────────────┤ ├─────────────┤ │ │ │ • 基础对话 │ │ • 无限对话 │ │ • 发布技能 │ │ │ │ • 3款皮肤 │ │ • 全部皮肤 │ │ • 技能收益 │ │ │ │ • 5个技能 │ │ • 无限技能 │ │ • 开发工具 │ │ │ │ • 基础整理 │ │ • 高级整理 │ │ • API访问 │ │ │ └─────────────┘ └─────────────┘ └─────────────┘ │ │ │ └─────────────────────────────────────────────────────────────────────────┘ 2.2 核心用户场景 场景一：日常陪伴互动 | 要素 | 描述 | |:---:|:---| | 用户 | 上班族小李，25岁 | | 情境 | 工作间隙想放松一下 | | 行为 | 点击桌宠进行对话互动 | | 期望 | 获得轻松愉快的对话体验，宠物有情感反馈 | | 成功标准 | 对话流畅自然，宠物表情动作匹配对话内容 | 场景二：任务执行 | 要素 | 描述 | |:---:|:---| | 用户 | 学生小王，20岁 | | 情境 | 需要设置多个提醒事项 | | 行为 | 语音告诉桌宠"帮我设置明天上午9点的会议提醒" | | 期望 | 桌宠自动创建提醒，无需手动操作 | | 成功标准 | 提醒准确创建，桌宠给予确认反馈 | 场景三：桌面整理 | 要素 | 描述 | |:---:|:---| | 用户 | 数码爱好者小张，28岁 | | 情境 | 桌面应用太多，杂乱无章 | | 行为 | 对桌宠说"帮我整理一下桌面" | | 期望 | 应用自动分类整理到文件夹 | | 成功标准 | 应用分类合理，整理过程可视化，可撤销 | 场景四：技能扩展 | 要素 | 描述 | |:---:|:---| | 用户 | 智能家居用户小赵，30岁 | | 情境 | 想用桌宠控制家里的小米设备 | | 行为 | 在技能市场安装"智能家居"技能 | | 期望 | 安装后可通过桌宠语音控制设备 | | 成功标准 | 技能安装成功，控制指令准确执行 | 3. 功能需求规格 3.1 功能模块总览 ┌─────────────────────────────────────────────────────────────────────────┐ │ 功能模块架构图 │ ├─────────────────────────────────────────────────────────────────────────┤ │ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ 核心功能层 │ │ │ │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────┐│ │ │ │ │ F1悬浮窗 │ │ F2对话聊天│ │ F3桌面整理│ │ F4任务执行 ││ │ │ │ │ 显示控制 │ │ │ │ │ │ ││ │ │ │ └──────────┘ └──────────┘ └──────────┘ └──────────────────┘│ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ 扩展功能层 │ │ │ │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────┐│ │ │ │ │ F5换皮系统│ │ F6技能市场│ │ F7记忆系统│ │ F8语音交互 ││ │ │ │ │ │ │ │ │ │ │ ││ │ │ │ └──────────┘ └──────────┘ └──────────┘ └──────────────────┘│ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ 支撑功能层 │ │ │ │ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────┐│ │ │ │ │ F9权限管理│ │ F10设置 │ │ F11账号 │ │ F12数据同步 ││ │ │ │ │ │ │ │ │ │ │ ││ │ │ │ └──────────┘ └──────────┘ └──────────┘ └──────────────────┘│ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ │ └─────────────────────────────────────────────────────────────────────────┘ 3.2 功能详细规格 F1 悬浮窗显示控制 | 属性 | 描述 | |:---:|:---| | 功能ID | F1 | | 功能名称 | 悬浮窗显示控制 | | 优先级 | P0 (最高) | | 功能描述 | 在手机屏幕上显示/隐藏桌宠悬浮窗，支持拖拽、点击、长按等交互 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F1-01 | 支持悬浮窗显示/隐藏切换 | 开关响应时间<200ms | | F1-02 | 支持悬浮窗拖拽移动 | 拖拽流畅，无卡顿 | | F1-03 | 支持点击互动触发 | 点击后宠物有动画反馈 | | F1-04 | 支持长按唤出管理菜单 | 长按1秒弹出菜单 | | F1-05 | 支持自动贴边吸附 | 释放后自动吸附到最近边缘 | | F1-06 | 支持多场景显示控制 | 可设置特定APP内隐藏 | | F1-07 | 支持透明度调节 | 透明度20%-100%可调 | | F1-08 | 支持大小调节 | 提供S/M/L三种尺寸 | 权限依赖： SYSTEM_ALERT_WINDOW (悬浮窗权限) FOREGROUND_SERVICE (前台服务权限) 异常处理： 权限未授予时引导用户开启 悬浮窗被系统关闭时自动重启服务 内存不足时自动降低渲染质量 F2 对话聊天 | 属性 | 描述 | |:---:|:---| | 功能ID | F2 | | 功能名称 | 对话聊天 | | 优先级 | P0 (最高) | | 功能描述 | 用户可与桌宠进行文字/语音对话，桌宠基于LLM生成回复并展示情感反馈 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F2-01 | 支持文字输入对话 | 输入框支持多行输入 | | F2-02 | 支持语音输入对话 | 语音识别准确率>90% | | F2-03 | 支持流式回复展示 | 首字延迟<500ms | | F2-04 | 支持对话历史查看 | 可查看最近100条对话 | | F2-05 | 支持对话内容复制 | 长按消息可复制 | | F2-06 | 支持对话内容删除 | 可删除单条或清空全部 | | F2-07 | 支持快捷短语 | 提供常用短语快捷输入 | | F2-08 | 支持情感化回复 | 回复内容匹配宠物性格 | | F2-09 | 支持多轮对话上下文 | 上下文窗口≥10轮 | | F2-10 | 支持对话中断续接 | 网络中断后可继续对话 | LLM配置： 默认模型：通义千问 Qwen-Max 备选模型：Qwen-Plus (成本优化) 端侧模型：Qwen-1.8B (离线模式) 对话流程： 用户输入 → 意图识别 → LLM处理 → 情感分析 → 回复生成 → 动画触发 → 展示回复 F3 桌面整理 | 属性 | 描述 | |:---:|:---| | 功能ID | F3 | | 功能名称 | 桌面整理 | | 优先级 | P1 (高) | | 功能描述 | 通过AI分析应用使用习惯，自动或半自动整理桌面应用图标位置 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F3-01 | 支持按类别自动分组 | 分类准确率>85% | | F3-02 | 支持按使用频率排序 | 频率统计准确 | | F3-03 | 支持按颜色分组 | 颜色识别准确 | | F3-04 | 支持整理预览 | 整理前可预览效果 | | F3-05 | 支持一键撤销 | 撤销响应时间<1s | | F3-06 | 支持自定义分类规则 | 可自定义类别名称 | | F3-07 | 支持整理历史记录 | 可查看最近5次整理记录 | | F3-08 | 支持排除特定应用 | 可设置不参与整理的应用 | 权限依赖： PACKAGE_USAGE_STATS (应用使用统计) QUERY_ALL_PACKAGES (查询所有应用) BIND_ACCESSIBILITY_SERVICE (无障碍服务) 限制说明： iOS平台不支持此功能，需明确告知用户 部分Android定制系统可能限制无障碍功能 整理过程需用户确认，避免误操作 F4 任务执行 (Agent) | 属性 | 描述 | |:---:|:---| | 功能ID | F4 | | 功能名称 | 任务执行 (Agent) | | 优先级 | P0 (最高) | | 功能描述 | 桌宠作为AI Agent，可理解和执行用户的复杂任务指令 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F4-01 | 支持任务意图识别 | 意图识别准确率>90% | | F4-02 | 支持多步骤任务规划 | 可分解≥5步的任务 | | F4-03 | 支持任务执行进度展示 | 实时显示执行进度 | | F4-04 | 支持任务执行结果反馈 | 执行完成后明确反馈 | | F4-05 | 支持任务执行失败处理 | 失败时给出原因和建议 | | F4-06 | 支持任务历史记录 | 可查看最近50条任务记录 | | F4-07 | 支持任务取消 | 执行中可随时取消 | | F4-08 | 支持定时任务 | 可设置定时执行的任务 | 支持的任务类型： | 任务类型 | 示例指令 | 执行方式 | |:---:|:---|:---| | 提醒设置 | "明天上午9点提醒我开会" | 调用系统日历API | | 应用启动 | "帮我打开微信" | 调用应用启动Intent | | 信息查询 | "今天天气怎么样" | 调用天气API | | 内容搜索 | "帮我搜一下AI新闻" | 调用搜索引擎 | | 设备控制 | "打开蓝牙" | 调用系统设置API | | 桌面整理 | "整理一下我的桌面" | 调用无障碍服务 | F5 换皮系统 | 属性 | 描述 | |:---:|:---| | 功能ID | F5 | | 功能名称 | 换皮系统 | | 优先级 | P1 (高) | | 功能描述 | 支持更换桌宠外观皮肤，包括官方皮肤和用户自定义皮肤 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F5-01 | 支持官方皮肤浏览 | 皮肤列表加载时间<1s | | F5-02 | 支持皮肤预览 | 预览响应时间<500ms | | F5-03 | 支持皮肤一键切换 | 切换过程无闪烁 | | F5-04 | 支持皮肤下载管理 | 支持断点续传 | | F5-05 | 支持皮肤收藏 | 可收藏喜欢的皮肤 | | F5-06 | 支持皮肤分享 | 可生成分享链接 | | F5-07 | 支持自定义皮肤上传 | 支持ZIP格式皮肤包 | | F5-08 | 支持皮肤动画配置 | 可配置待机/互动/反馈动画 | 皮肤规格要求： | 资源类型 | 格式要求 | 尺寸要求 | 大小限制 | |:---:|:---:|:---:|:---:| | 待机图片 | PNG/WebP | 200x300px | <500KB | | 互动动画 | Lottie/Spine | - | <2MB | | 语音包 | MP3/AAC | - | <5MB | | 配置文件 | JSON | - | <50KB | F6 技能市场 | 属性 | 描述 | |:---:|:---| | 功能ID | F6 | | 功能名称 | 技能市场 | | 优先级 | P1 (高) | | 功能描述 | 提供技能下载、安装、管理功能，支持第三方开发者发布技能 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F6-01 | 支持技能浏览搜索 | 搜索响应时间<500ms | | F6-02 | 支持技能详情查看 | 展示技能介绍、权限、评价 | | F6-03 | 支持技能下载安装 | 下载速度>1MB/s | | F6-04 | 支持技能启用/禁用 | 切换即时生效 | | F6-05 | 支持技能卸载 | 卸载后清理所有数据 | | F6-06 | 支持技能更新提醒 | 有新版本时通知用户 | | F6-07 | 支持技能评价评分 | 1-5星评分+文字评价 | | F6-08 | 支持技能分类筛选 | 按类别/热度/评分筛选 | 技能分类： | 分类 | 示例技能 | |:---:|:---| | 效率工具 | 待办管理、日程提醒、笔记记录 | | 生活服务 | 天气查询、快递追踪、汇率转换 | | 娱乐休闲 | 笑话大全、星座运势、今日食谱 | | 智能家居 | 米家控制、HomeKit、小爱同学 | | 社交通讯 | 微信快捷、邮件助手、消息聚合 | | 系统工具 | 清理加速、电池优化、网络诊断 | F7 记忆系统 | 属性 | 描述 | |:---:|:---| | 功能ID | F7 | | 功能名称 | 记忆系统 | | 优先级 | P1 (高) | | 功能描述 | 桌宠可记住用户偏好、历史对话、重要信息，实现个性化互动 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F7-01 | 支持短期记忆存储 | 存储最近100条对话 | | F7-02 | 支持长期记忆存储 | 基于向量检索的重要记忆 | | F7-03 | 支持用户偏好学习 | 自动学习用户习惯 | | F7-04 | 支持记忆检索 | 对话时可检索相关记忆 | | F7-05 | 支持记忆查看 | 用户可查看存储的记忆 | | F7-06 | 支持记忆删除 | 用户可删除特定记忆 | | F7-07 | 支持记忆导出 | 可导出记忆数据为JSON | | F7-08 | 支持记忆清空 | 一键清空所有记忆 | 记忆类型： | 类型 | 存储内容 | 保留期限 | |:---:|:---|:---| | 短期记忆 | 最近对话内容 | 30天 | | 长期记忆 | 重要信息、偏好 | 永久 | | 用户画像 | 兴趣、习惯、性格 | 永久 | | 任务历史 | 执行过的任务记录 | 90天 | F8 语音交互 | 属性 | 描述 | |:---:|:---| | 功能ID | F8 | | 功能名称 | 语音交互 | | 优先级 | P1 (高) | | 功能描述 | 支持语音输入和语音输出，实现自然语音对话 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F8-01 | 支持语音唤醒 | 唤醒词识别准确率>95% | | F8-02 | 支持语音输入 | 语音识别准确率>90% | | F8-03 | 支持语音输出 | TTS发音自然流畅 | | F8-04 | 支持多语言识别 | 支持中文、英文 | | F8-05 | 支持语音音量调节 | 音量0-100%可调 | | F8-06 | 支持语音语速调节 | 语速0.5-2.0倍可调 | | F8-07 | 支持语音音色选择 | 提供≥3种音色 | | F8-08 | 支持静音模式 | 可关闭语音输出 | 语音服务选型： | 服务类型 | 推荐方案 | 备选方案 | |:---:|:---|:---| | 语音识别(ASR) | 讯飞听见 | 百度语音、Google Speech | | 语音合成(TTS) | 通义听悟 | Azure TTS、Google TTS | F9 权限管理 | 属性 | 描述 | |:---:|:---| | 功能ID | F9 | | 功能名称 | 权限管理 | | 优先级 | P0 (最高) | | 功能描述 | 统一管理应用所需权限，提供清晰的权限说明和引导 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F9-01 | 支持权限状态查看 | 清晰展示已授/未授权限 | | F9-02 | 支持权限一键申请 | 点击直接跳转设置页面 | | F9-03 | 支持权限说明展示 | 每个权限有详细说明 | | F9-04 | 支持厂商适配 | 适配主流厂商权限页面 | | F9-05 | 支持权限引导教程 | 提供图文/视频引导 | | F9-06 | 支持权限必要性说明 | 标注必选/可选权限 | 权限列表： | 权限 | 用途 | 必要性 | |:---:|:---|:---:| | 悬浮窗 | 显示桌宠悬浮窗 | 必选 | | 无障碍 | 桌面整理功能 | 可选 | | 麦克风 | 语音交互 | 可选 | | 通知 | 任务提醒 | 必选 | | 存储 | 皮肤/技能下载 | 必选 | | 网络 | LLM对话、技能市场 | 必选 | F10 设置 | 属性 | 描述 | |:---:|:---| | 功能ID | F10 | | 功能名称 | 设置 | | 优先级 | P1 (高) | | 功能描述 | 提供应用各项配置选项 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F10-01 | 支持宠物性格设置 | 提供≥5种性格选项 | | F10-02 | 支持对话模式设置 | 简洁/详细/幽默模式 | | F10-03 | 支持通知设置 | 可自定义通知类型 | | F10-04 | 支持隐私设置 | 数据收集开关 | | F10-05 | 支持账号设置 | 登录/登出/切换账号 | | F10-06 | 支持关于页面 | 版本信息、开源协议 | | F10-07 | 支持反馈入口 | 问题反馈、建议提交 | | F10-08 | 支持检查更新 | 手动/自动检查更新 | F11 账号系统 | 属性 | 描述 | |:---:|:---| | 功能ID | F11 | | 功能名称 | 账号系统 | | 优先级 | P2 (中) | | 功能描述 | 支持用户注册登录，实现数据云端同步 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F11-01 | 支持手机号注册登录 | 验证码登录 | | F11-02 | 支持第三方登录 | 微信、QQ、Apple ID | | F11-03 | 支持账号绑定 | 可绑定多个第三方账号 | | F11-04 | 支持密码找回 | 通过手机号找回 | | F11-05 | 支持账号注销 | 注销后删除所有数据 | | F11-06 | 支持会员订阅 | 付费会员功能 | F12 数据同步 | 属性 | 描述 | |:---:|:---| | 功能ID | F12 | | 功能名称 | 数据同步 | | 优先级 | P2 (中) | | 功能描述 | 支持用户数据云端备份和跨设备同步 | 功能需求： | 需求ID | 需求描述 | 验收标准 | |:---:|:---|:---| | F12-01 | 支持自动备份 | 每日自动备份 | | F12-02 | 支持手动备份 | 用户可手动触发备份 | | F12-03 | 支持数据恢复 | 可从云端恢复数据 | | F12-04 | 支持跨设备同步 | 多设备数据一致 | | F12-05 | 支持同步冲突处理 | 智能合并或用户选择 | | F12-06 | 支持同步状态展示 | 显示最后同步时间 | 4. 非功能需求 4.1 性能需求 | 指标 | 要求 | 测量方法 | |:---:|:---:|:---| | 启动时间 | 冷启动<2s，热启动<500ms | 从点击图标到主界面显示 | | 悬浮窗响应 | 点击响应<100ms | 从点击到动画开始 | | LLM首字延迟 | <500ms | 从发送消息到首个字符显示 | | 内存占用 | <200MB (空闲)，<400MB (活跃) | Android Profiler测量 | | CPU占用 | <10% (空闲)，<30% (活跃) | Android Profiler测量 | | 电池消耗 | <5%/天 (正常使用) | 系统电池统计 | | 网络流量 | <50MB/天 (正常使用) | 系统流量统计 | 4.2 兼容性需求 | 维度 | 要求 | |:---:|:---| | Android版本 | Android 8.0+ (API 26+)，目标版本Android 14 (API 34) | | iOS版本 | iOS 15+ (功能受限，仅提供简化版) | | 屏幕适配 | 支持4.7-7.0英寸屏幕，支持折叠屏 | | 分辨率 | 支持720p/1080p/2K/4K分辨率 | | 厂商适配 | 华为、小米、OPPO、vivo、荣耀、三星、一加等主流品牌 | | 处理器 | 支持ARMv8/ARMv9架构，支持x86模拟器 | 4.3 安全需求 | 要求 | 描述 | |:---:|:---| | 数据加密 | 本地数据使用AES-256加密存储 | | 传输安全 | 所有网络请求使用HTTPS (TLS 1.3) | | API密钥 | 密钥存储在Android Keystore中 | | 权限最小化 | 仅申请必要权限，提供权限使用说明 | | 隐私合规 | 符合GDPR、个人信息保护法要求 | | 代码安全 | 代码混淆，防止反编译泄露敏感信息 | 4.4 可靠性需求 | 指标 | 要求 | |:---:|:---| | 崩溃率 | <0.5% (日活跃用户) | | ANR率 | <0.3% (日活跃用户) | | 服务可用性 | >99.5% (云端服务) | | 数据完整性 | 100% (无数据丢失) | | 故障恢复 | 服务故障后5分钟内自动恢复 | 4.5 可维护性需求 | 要求 | 描述 | |:---:|:---| | 代码规范 | 遵循Google Kotlin代码规范 | | 注释要求 | 核心逻辑注释覆盖率>80% | | 单元测试 | 核心模块单元测试覆盖率>70% | | 日志规范 | 统一日志格式，支持日志分级 | | 配置管理 | 可配置项集中管理，支持远程配置 | 5. 数据模型设计 5.1 核心数据实体 用户表 (users) CREATE TABLE users ( id TEXT PRIMARY KEY, phone TEXT UNIQUE, email TEXT, nickname TEXT, avatar_url TEXT, member_level INTEGER DEFAULT 0, created_at INTEGER NOT NULL, updated_at INTEGER NOT NULL, last_login_at INTEGER ); 对话记录表 (conversations) CREATE TABLE conversations ( id TEXT PRIMARY KEY, user_id TEXT NOT NULL, role TEXT NOT NULL, -- user/assistant/system content TEXT NOT NULL, tokens INTEGER, created_at INTEGER NOT NULL, FOREIGN KEY (user_id) REFERENCES users(id) ); CREATE INDEX idx_conversations_user ON conversations(user_id); CREATE INDEX idx_conversations_created ON conversations(created_at); 记忆表 (memories) CREATE TABLE memories ( id TEXT PRIMARY KEY, user_id TEXT NOT NULL, type TEXT NOT NULL, -- short_term/long_term content TEXT NOT NULL, embedding BLOB, -- 向量数据 importance REAL DEFAULT 0.5, access_count INTEGER DEFAULT 0, created_at INTEGER NOT NULL, expires_at INTEGER, FOREIGN KEY (user_id) REFERENCES users(id) ); CREATE INDEX idx_memories_user ON memories(user_id); CREATE INDEX idx_memories_type ON memories(type); 皮肤表 (skins) CREATE TABLE skins ( id TEXT PRIMARY KEY, name TEXT NOT NULL, description TEXT, thumbnail_url TEXT, preview_url TEXT, download_url TEXT, file_size INTEGER, version TEXT, is_official INTEGER DEFAULT 1, is_downloaded INTEGER DEFAULT 0, is_favorite INTEGER DEFAULT 0, created_at INTEGER NOT NULL, updated_at INTEGER NOT NULL ); 技能表 (skills) CREATE TABLE skills ( id TEXT PRIMARY KEY, name TEXT NOT NULL, description TEXT, icon_url TEXT, version TEXT NOT NULL, category TEXT, permissions TEXT, -- JSON数组 download_url TEXT, file_size INTEGER, is_installed INTEGER DEFAULT 0, is_enabled INTEGER DEFAULT 1, install_at INTEGER, updated_at INTEGER NOT NULL ); 任务记录表 (tasks) CREATE TABLE tasks ( id TEXT PRIMARY KEY, user_id TEXT NOT NULL, type TEXT NOT NULL, status TEXT NOT NULL, -- pending/running/completed/failed input TEXT, output TEXT, error_message TEXT, started_at INTEGER, completed_at INTEGER, created_at INTEGER NOT NULL, FOREIGN KEY (user_id) REFERENCES users(id) ); CREATE INDEX idx_tasks_user ON tasks(user_id); CREATE INDEX idx_tasks_status ON tasks(status); 用户配置表 (user_preferences) CREATE TABLE user_preferences ( id TEXT PRIMARY KEY, user_id TEXT NOT NULL, key TEXT NOT NULL, value TEXT NOT NULL, updated_at INTEGER NOT NULL, FOREIGN KEY (user_id) REFERENCES users(id), UNIQUE(user_id, key) ); 5.2 数据关系图 ┌─────────────────────────────────────────────────────────────────────────┐ │ 数据关系图 │ ├─────────────────────────────────────────────────────────────────────────┤ │ │ │ ┌──────────┐ ┌──────────────┐ ┌──────────┐ │ │ │ users │◄────────│ conversations│ │ skins │ │ │ └────┬─────┘ 1:N └──────────────┘ └──────────┘ │ │ │ │ │ │ 1:N │ │ ▼ │ │ ┌──────────┐ ┌──────────────┐ ┌──────────┐ │ │ │ memories │ │ tasks │ │ skills │ │ │ └──────────┘ └──────────────┘ └──────────┘ │ │ │ │ ┌──────────────────┐ │ │ │ user_preferences │ │ │ └──────────────────┘ │ │ │ └─────────────────────────────────────────────────────────────────────────┘ 6. API接口定义 6.1 通义千问LLM API 对话接口 POST https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation Content-Type: application/json Authorization: Bearer ${API_KEY} { "model": "qwen-max", "input": { "messages": [ {"role": "system", "content": "你是一个可爱的桌面宠物助手"}, {"role": "user", "content": "你好"} ] }, "parameters": { "temperature": 0.8, "max_tokens": 500, "top_p": 0.9, "stream": false } } Response: { "output": { "choices": [{ "message": { "role": "assistant", "content": "你好呀！我是你的桌面宠物~" } }] }, "usage": { "input_tokens": 20, "output_tokens": 15 }, "request_id": "xxx-xxx-xxx" } 6.2 技能市场API 获取技能列表 GET https://api.petdesk.com/v1/skills Authorization: Bearer ${USER_TOKEN} Response: { "code": 0, "data": { "skills": [ { "id": "todo_manager", "name": "待办管理", "description": "创建、查看和管理待办事项", "icon_url": "https://cdn.petdesk.com/skills/todo.png", "version": "1.0.0", "category": "效率工具", "download_count": 10000, "rating": 4.8 } ], "total": 50, "page": 1, "page_size": 20 } } 下载技能 POST https://api.petdesk.com/v1/skills/{skill_id}/download Authorization: Bearer ${USER_TOKEN} Response: { "code": 0, "data": { "download_url": "https://cdn.petdesk.com/skills/todo_v1.0.0.zip", "file_size": 1024000, "md5": "xxx-xxx-xxx", "expires_at": 1708800000 } } 6.3 皮肤市场API 获取皮肤列表 GET https://api.petdesk.com/v1/skins Authorization: Bearer ${USER_TOKEN} Response: { "code": 0, "data": { "skins": [ { "id": "cat_001", "name": "小猫咪", "description": "可爱的猫咪宠物", "thumbnail_url": "https://cdn.petdesk.com/skins/cat_thumb.png", "preview_url": "https://cdn.petdesk.com/skins/cat_preview.gif", "is_official": true, "is_free": true, "download_count": 50000 } ], "total": 100, "page": 1, "page_size": 20 } } 6.4 用户数据同步API POST https://api.petdesk.com/v1/users/{user_id}/sync/upload Authorization: Bearer ${USER_TOKEN} Content-Type: application/json { "data_type": "conversations", "data": [...], "checksum": "xxx-xxx-xxx", "timestamp": 1708800000 } Response: { "code": 0, "data": { "sync_id": "sync-xxx-xxx", "status": "success" } } 下载数据 GET https://api.petdesk.com/v1/users/{user_id}/sync/download?data_type=conversations&since=1708800000 Authorization: Bearer ${USER_TOKEN} Response: { "code": 0, "data": { "data_type": "conversations", "data": [...], "checksum": "xxx-xxx-xxx", "timestamp": 1708800000 } } 7. UI/UX设计规范 7.1 设计风格 | 要素 | 规范 | |:---:|:---| | 设计语言 | Material Design 3 + 个性化元素 | | 主色调 | #6C5CE7 (紫色系，温暖亲和) | | 辅助色 | #00CEC9 (青色), #FD79A8 (粉色) | | 字体 | 中文：思源黑体 / 英文：Roboto | | 圆角 | 卡片圆角16dp，按钮圆角8dp | | 阴影 | 轻度阴影，营造悬浮感 | 7.2 核心界面设计 主界面 ┌─────────────────────────────────────────────────────────────────────────┐ │ ☰ 桌宠助手 🔔 ⚙️ │ ├─────────────────────────────────────────────────────────────────────────┤ │ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ │ │ │ │ 🐱 宠物展示区域 │ │ │ │ (点击互动/拖拽移动) │ │ │ │ │ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ 💬 对话 📋 任务 🎨 皮肤 🛒 技能 📊 统计 │ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ 最近对话 │ │ │ │ ┌─────────────────────────────────────────────────────────┐ │ │ │ │ │ 👤 你：今天天气怎么样？ │ │ │ │ │ │ 🐱 宠物：今天晴朗，温度25度，适合出门哦~ │ │ │ │ │ └─────────────────────────────────────────────────────────┘ │ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ │ └─────────────────────────────────────────────────────────────────────────┘ └─────────────────────────────────────────────────────────────────────────┘ 对话界面 ┌─────────────────────────────────────────────────────────────────────────┐ │ ← 对话 🗑️ ⋮ │ ├─────────────────────────────────────────────────────────────────────────┤ │ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ 🐱 你好呀！我是你的桌面宠物，有什么可以帮你的吗？ │ │ │ │ 10:30 │ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ 今天天气怎么样？ │ │ │ │ 10:31 │ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ 🐱 今天晴朗，温度25度，空气质量优，适合出门活动哦~ │ │ │ │ 10:31 │ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ │ ├─────────────────────────────────────────────────────────────────────────┤ │ ┌─────────────────────────────────────────────┐ 🎤 ➤ │ │ │ 输入消息... │ │ │ └─────────────────────────────────────────────┘ │ └─────────────────────────────────────────────────────────────────────────┘ 技能市场界面 ┌─────────────────────────────────────────────────────────────────────────┐ │ ← 技能市场 🔍 │ ├─────────────────────────────────────────────────────────────────────────┤ │ │ │ ┌─────────────────────────────────────────────────────────────────┐ │ │ │ 全部 效率工具 生活服务 娱乐休闲 智能家居 系统工具 │ │ │ └─────────────────────────────────────────────────────────────────┘ │ │ │ │ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ │ │ │ 📋 │ │ 🌤️ │ │ 🏠 │ │ │ │ 待办管理 │ │ 天气查询 │ │ 智能家居 │ │ │ │ ⭐4.8 10k下载│ │ ⭐4.7 8k下载 │ │ ⭐4.9 5k下载 │ │ │ │ [已安装] │ │ [安装] │ │ [安装] │ │ │ └───────────────┘ └───────────────┘ └───────────────┘ │ │ │ │ ┌───────────────┐ ┌───────────────┐ ┌───────────────┐ │ │ │ 🎵 │ │ 📧 │ │ 🧹 │ │ │ │ 音乐控制 │ │ 邮件助手 │ │ 清理加速 │ │ │ │ ⭐4.6 6k下载 │ │ ⭐4.5 4k下载 │ │ ⭐4.7 7k下载 │ │ │ │ [安装] │ │ [安装] │ │ [安装] │ │ │ └───────────────┘ └───────────────┘ └───────────────┘ │ │ │ └─────────────────────────────────────────────────────────────────────────┘ 7.3 交互动效规范 | 动效类型 | 时长 | 缓动曲线 | 应用场景 | |:---:|:---:|:---:|:---| | 页面切换 | 300ms | ease-out | Activity/Fragment切换 | | 按钮点击 | 150ms | ease-in-out | 按钮反馈 | | 悬浮窗拖拽 | 实时 | - | 悬浮窗移动 | | 宠物动画 | 500-2000ms | 自定义 | 宠物互动反馈 | | 加载动画 | - | linear | 数据加载 | 8. 技术约束与依赖 8.1 技术栈要求 | 层级 | 技术选型 | 版本要求 | |:---:|:---|:---| | 开发语言 | Kotlin | 2.0+ | | UI框架 | Jetpack Compose | 1.6+ | | 架构模式 | MVVM + Clean Architecture | - | | 依赖注入 | Hilt | 2.51+ | | 网络请求 | Retrofit + OkHttp | 2.11+ | | 本地数据库 | Room | 2.6+ | | 异步处理 | Kotlin Coroutines + Flow | 1.8+ | | 图片加载 | Glide | 4.16+ | | 动画引擎 | Lottie | 6.0+ | 8.2 第三方服务依赖 | 服务 | 提供商 | 用途 | 成本估算 | |:---:|:---|:---|:---| | LLM API | 阿里云通义千问 | 对话生成 | ¥0.02/1K tokens | | 语音识别 | 讯飞听见 | 语音转文字 | ¥0.0008/秒 | | 语音合成 | 通义听悟 | 文字转语音 | ¥0.0005/字 | | 向量数据库 | Milvus Lite | 记忆检索 | 免费(端侧) | | 文件存储 | 阿里云OSS | 皮肤/技能存储 | ¥0.12/GB/月 | | 消息推送 | 阿里云移动推送 | 通知推送 | 免费(10万DAU内) | 8.3 系统限制 | 限制项 | 说明 | 应对方案 | |:---:|:---|:---| | 悬浮窗权限 | Android 6.0+需用户手动授权 | 提供详细引导教程 | | 后台保活 | 各厂商限制不同 | 前台服务+通知常驻 | | 无障碍服务 | 需用户手动开启 | 提供开启引导视频 | | iOS悬浮窗 | iOS不支持真正悬浮窗 | 提供小组件替代方案 | | 电池优化 | 系统可能限制后台运行 | 引导用户关闭电池优化 | 9. 验收标准 9.1 功能验收标准 | 功能模块 | 验收项 | 通过标准 | |:---:|:---:|:---| | 悬浮窗 | 显示/隐藏 | 开关响应<200ms，无崩溃 | | 悬浮窗 | 拖拽移动 | 拖拽流畅，无卡顿 | | 对话聊天 | 文字对话 | 消息发送成功率>99% | | 对话聊天 | 语音对话 | 识别准确率>90% | | 桌面整理 | 应用分类 | 分类准确率>85% | | 桌面整理 | 整理执行 | 执行成功率>95% | | 任务执行 | 意图识别 | 识别准确率>90% | | 任务执行 | 任务执行 | 执行成功率>95% | | 换皮系统 | 皮肤切换 | 切换无闪烁，资源加载<1s | | 技能市场 | 技能安装 | 安装成功率>99% | | 技能市场 | 技能执行 | 执行成功率>98% | 9.2 性能验收标准 | 指标 | 要求 | 测试方法 | |:---:|:---:|:---| | 启动时间 | 冷启动<2s | Android Vitals | | 内存占用 | <200MB(空闲) | Android Profiler | | CPU占用 | <10%(空闲) | Android Profiler | | 电池消耗 | <5%/天 | 系统电池统计 | | 崩溃率 | <0.5% | Firebase Crashlytics | | ANR率 | <0.3% | Android Vitals | 9.3 兼容性验收标准 | 测试维度 | 覆盖要求 | |:---:|:---| | Android版本 | 8.0/9.0/10.0/11.0/12.0/13.0/14.0 | | 主流品牌 | 华为、小米、OPPO、vivo、荣耀、三星 | | 屏幕尺寸 | 5.0"/5.5"/6.0"/6.5"/6.7"/折叠屏 | | 分辨率 | 720p/1080p/2K/4K | 9.4 安全验收标准 | 检查项 | 要求 | |:---:|:---| | 数据加密 | 本地敏感数据加密存储 | | 传输安全 | 所有网络请求HTTPS | | 权限合规 | 无过度申请权限 | | 隐私政策 | 符合法律法规要求 | | 代码安全 | 通过安全扫描无高危漏洞 | 10. 开发里程碑 10.1 项目时间规划 ┌─────────────────────────────────────────────────────────────────────────┐ │ 项目开发时间线 (6个月) │ ├─────────────────────────────────────────────────────────────────────────┤ │ │ │ 第1月 第2月 第3月 第4月 第5月 │ │ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │ │ │M1 │ │M2 │ │M3 │ │M4 │ │M5 │ │ │ │基础 │ │核心 │ │进阶 │ │优化 │ │发布 │ │ │ │框架 │ │功能 │ │功能 │ │测试 │ │上线 │ │ │ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │ │ │ │ ✓ 悬浮窗 ✓ LLM对话 ✓ 桌面整理 ✓ 性能优化 ✓ 应用商店 │ │ ✓ 权限管理 ✓ Agent任务 ✓ 语音交互 ✓ 安全加固 ✓ 运营准备 │ │ ✓ 数据库 ✓ 记忆系统 ✓ 皮肤市场 ✓ 兼容性测试 ✓ 灰度发布 │ │ ✓ 主界面 ✓ Skills框架 ✓ 账号系统 ✓ Bug修复 ✓ 正式发布 │ │ │ └─────────────────────────────────────────────────────────────────────────┘ 10.2 里程碑详细规划 M1 基础框架 (第1月) | 周次 | 任务 | 交付物 | |:---:|:---|:---| | W1 | 项目搭建、技术选型、架构设计 | 技术架构文档、项目骨架 | | W2 | 悬浮窗模块开发 | 悬浮窗显示/隐藏功能 | | W3 | 权限管理模块开发 | 权限申请引导完整流程 | | W4 | 数据库设计实现、主界面开发 | Room数据库、主界面UI | M1验收标准： 悬浮窗可正常显示隐藏，权限引导完整，主界面可导航 M2 核心功能 (第2月) | 周次 | 任务 | 交付物 | |:---:|:---|:---| | W5 | LLM API集成、对话功能开发 | 文字对话功能可用 | | W6 | Agent架构实现、任务执行模块 | 基础任务执行能力 | | W7 | 记忆系统开发 | 短期/长期记忆存储检索 | | W8 | Skills框架开发 | 技能加载执行框架 | M2验收标准： 可与桌宠对话，可执行基础任务，技能框架可运行 M3 进阶功能 (第3月) | 周次 | 任务 | 交付物 | |:---:|:---|:---| | W9 | 桌面整理功能开发 | 应用分类整理功能 | | W10 | 语音交互模块开发 | 语音输入输出功能 | | W11 | 皮肤市场开发 | 皮肤浏览下载切换 | | W12 | 技能市场开发 | 技能浏览下载安装 | M3验收标准： 桌面整理可用，语音交互可用，皮肤技能市场可运行 M4 优化测试 (第4月) | 周次 | 任务 | 交付物 | |:---:|:---|:---| | W13 | 性能优化、电池优化 | 性能测试报告 | | W14 | 安全加固、隐私合规 | 安全扫描报告 | | W15 | 兼容性测试、Bug修复 | 兼容性测试报告 | | W16 | 用户体验优化、UI调整 | 用户体验报告 | M4验收标准： 性能指标达标，无高危安全漏洞，主流机型兼容 M5 发布上线 (第5月) | 周次 | 任务 | 交付物 | |:---:|:---|:---| | W17 | 应用商店素材准备 | 商店页面素材 | | W18 | 灰度发布、数据监控 | 灰度发布报告 | | W19 | 问题修复、稳定性优化 | 稳定性报告 | | W20 | 正式发布、运营推广 | 正式发布版本 | M5验收标准： 应用商店审核通过，正式发布上线 10.3 团队配置 | 角色 | 人数 | 职责 | |:---:|:---:|:---| | Android开发 | 2-3人 | 核心功能开发 | | AI/LLM工程师 | 1人 | Agent架构、LLM集成 | | UI/UX设计师 | 1人 | 界面设计、动画设计 | | 测试工程师 | 1人 | 功能测试、兼容性测试 | | 产品经理 | 1人 | 需求管理、版本规划 | | 后端开发 | 1人 | 云端API、数据同步 | 10.4 风险管理 | 风险 | 概率 | 影响 | 应对措施 | |:---:|:---:|:---:|:---| | 系统权限限制 | 高 | 高 | 提前调研各厂商政策，准备替代方案 | | LLM API成本超预算 | 中 | 中 | 设置使用限额，优化请求策略 | | 后台保活困难 | 高 | 中 | 多方案保活，引导用户设置 | | 开发周期延期 | 中 | 高 | 预留缓冲时间，优先级管理 | | 应用商店审核不通过 | 中 | 高 | 提前了解审核规范，准备申诉材料 | 附录 A. 术语表 | 术语 | 定义 | |:---:|:---| | 桌宠 | 桌面宠物的简称，指在屏幕上显示的虚拟宠物角色 | | 悬浮窗 | 可悬浮在其他应用上方的窗口 | | LLM | 大型语言模型(Large Language Model) | | Agent | AI代理，可自主规划和执行任务的智能体 | | Skills | 技能，可扩展桌宠功能的插件模块 | | 无障碍服务 | Android系统提供的辅助功能服务 | B. 参考文档 Android悬浮窗开发指南 通义千问API文档 Material Design 3规范 Android权限最佳实践 文档结束 本需求文档为内部机密文件，未经授权不得外传